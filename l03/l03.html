<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>WebXR AR –°–∞—Ç—É—Ä–Ω</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      margin: 0;
      overflow: hidden;
      font-family: Arial, sans-serif;
      background: linear-gradient(to bottom, #000428, #004e92);
    }
    
    #container {
      width: 100vw;
      height: 100vh;
      position: relative;
      overflow: hidden;
    }
    
    #ui-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1000;
    }
    
    .info {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 15px;
      font-size: 14px;
      border-radius: 10px;
      z-index: 1;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      pointer-events: auto;
    }
    
    #status {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 10px 15px;
      border-radius: 10px;
      font-size: 12px;
      pointer-events: auto;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .status-ready { color: #4caf50; }
    .status-active { color: #2196f3; }
    .status-error { color: #f44336; }
    
    #ar-button {
      position: absolute;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(45deg, #ff6b6b, #ee5a24);
      border: none;
      padding: 15px 25px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 16px;
      color: white;
      font-weight: bold;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      pointer-events: auto;
    }
    
    #ar-button:hover {
      transform: translateX(-50%) translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
    }
    
    #ar-button:active {
      transform: translateX(-50%) translateY(0);
    }
    
    #instructions {
      position: absolute;
      bottom: 200px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 15px;
      border-radius: 10px;
      font-size: 12px;
      text-align: center;
      max-width: 300px;
      pointer-events: auto;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    #controls {
      position: absolute;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 10px;
      pointer-events: auto;
    }
    
    button {
      background: linear-gradient(45deg, #667eea, #764ba2);
      border: none;
      padding: 12px 20px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 14px;
      color: white;
      font-weight: bold;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
    }
    
    .highlight {
      color: #64b5f6;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div id="container"></div>
  
  <div id="ui-overlay">
    <div class="info">
      <div style="font-size: 16px; margin-bottom: 10px;">ü™ê WebXR AR –°–∞—Ç—É—Ä–Ω</div>
      <div>–û–±–µ—Ä—Ç–∞–Ω–Ω—è: <span class="highlight" id="rotation-speed">1x</span></div>
      <div>–ö—ñ–ª—å—Ü—è: <span class="highlight" id="rings-opacity">60%</span></div>
      <div style="margin-top: 10px; font-size: 12px;">
        –ù–∞–≤–µ–¥—ñ—Ç—å –∫–∞–º–µ—Ä—É –Ω–∞–≤–∫–æ–ª–æ —Å–µ–±–µ –¥–ª—è —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è –°–∞—Ç—É—Ä–Ω–∞
      </div>
    </div>
    
    <div id="status">
      <div id="webxr-status">WebXR: <span class="status-ready">–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞...</span></div>
      <div id="session-status">–°–µ—Å—ñ—è: <span>–ù–µ–∞–∫—Ç–∏–≤–Ω–∞</span></div>
    </div>
    
    <div id="instructions">
      <div>üì± –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É AR –¥–ª—è –∑–∞–ø—É—Å–∫—É –¥–æ–ø–æ–≤–Ω–µ–Ω–æ—ó —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—ñ</div>
      <div style="margin-top: 10px; font-size: 10px; opacity: 0.8;">
        –ù–∞–ø—Ä–∞–≤—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ –ø–ª–æ—Å–∫—É –ø–æ–≤–µ—Ä—Ö–Ω—é —Ç–∞ —Ç–æ—Ä–∫–Ω—ñ—Ç—å—Å—è –¥–ª—è —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è –°–∞—Ç—É—Ä–Ω–∞
      </div>
    </div>
    
    <button id="ar-button">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç–∏ AR</button>
    
    <div id="controls">
      <button onclick="toggleAnimation()">‚è∏Ô∏è –ü–∞—É–∑–∞</button>
      <button onclick="changeSpeed()">‚ö° x1</button>
      <button onclick="toggleRings()">üíç –ö—ñ–ª—å—Ü—è</button>
      <button onclick="resetPosition()">üîÑ –°–∫–∏–Ω—É—Ç–∏</button>
    </div>
  </div>

  <script type="module">
    import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.module.js';
    import { ARButton } from 'https://cdn.jsdelivr.net/npm/three@0.158.0/examples/jsm/webxr/ARButton.js';

    // –ó–º—ñ–Ω–Ω—ñ —Å—Ü–µ–Ω–∏
    let scene, camera, renderer;
    let saturnGroup, saturn, ring;
    let reticle, hitTestSource, hitTestSourceRequested = false;
    
    // –ó–º—ñ–Ω–Ω—ñ –∞–Ω—ñ–º–∞—Ü—ñ—ó
    let isAnimating = true;
    let animationSpeed = 1;
    let rotationSpeed = 0.01;
    let ringsVisible = true;
    let originalPosition = new THREE.Vector3(0, 0, -2);
    
    const clock = new THREE.Clock();

    async function init() {
      const container = document.getElementById('container');

      // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å—Ü–µ–Ω–∏
      scene = new THREE.Scene();

      // –ö–∞–º–µ—Ä–∞
      camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.01, 20);

      // –†–µ–Ω–¥–µ—Ä–µ—Ä –∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é WebXR
      renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
      renderer.setPixelRatio(window.devicePixelRatio);
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.shadowMap.enabled = true;
      renderer.shadowMap.type = THREE.PCFSoftShadowMap;
      renderer.xr.enabled = true;
      container.appendChild(renderer.domElement);

      // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ WebXR
      checkWebXRSupport();

      // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è AR –∫–Ω–æ–ø–∫–∏
      const arButton = ARButton.createButton(renderer, {
        requiredFeatures: ['hit-test'],
        optionalFeatures: ['dom-overlay'],
        domOverlay: { root: document.getElementById('ui-overlay') }
      });

      // –ó–∞–º—ñ–Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ—ó –∫–Ω–æ–ø–∫–∏ –Ω–∞ –Ω–∞—à—É
      const customARButton = document.getElementById('ar-button');
      customARButton.addEventListener('click', () => {
        arButton.click();
      });

      // –û–±—Ä–æ–±–Ω–∏–∫–∏ –ø–æ–¥—ñ–π WebXR
      renderer.xr.addEventListener('sessionstart', onSessionStart);
      renderer.xr.addEventListener('sessionend', onSessionEnd);

      // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è
      setupLighting();

      // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –°–∞—Ç—É—Ä–Ω–∞
      await createSaturn();

      // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è reticle
      createReticle();

      // –ü–æ—á–∞—Ç–∫–æ–≤–µ —Ä–æ–∑—Ç–∞—à—É–≤–∞–Ω–Ω—è –≤ –∑–≤–∏—á–∞–π–Ω–æ–º—É —Ä–µ–∂–∏–º—ñ
      saturnGroup.position.copy(originalPosition);
      saturnGroup.scale.setScalar(0.5);

      // –ó–∞–ø—É—Å–∫ –∞–Ω—ñ–º–∞—Ü—ñ—ó
      renderer.setAnimationLoop(animate);

      // –û–±—Ä–æ–±–∫–∞ –∑–º—ñ–Ω–∏ —Ä–æ–∑–º—ñ—Ä—É
      window.addEventListener('resize', onWindowResize);
    }

    function checkWebXRSupport() {
      const statusElement = document.getElementById('webxr-status');
      
      if ('xr' in navigator) {
        navigator.xr.isSessionSupported('immersive-ar').then((supported) => {
          if (supported) {
            statusElement.innerHTML = 'WebXR: <span class="status-ready">–ì–æ—Ç–æ–≤–æ</span>';
          } else {
            statusElement.innerHTML = 'WebXR: <span class="status-error">AR –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è</span>';
            document.getElementById('ar-button').style.display = 'none';
            document.getElementById('instructions').innerHTML = 
              '<div>‚ùå –í–∞—à –ø—Ä–∏—Å—Ç—Ä—ñ–π –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î WebXR AR</div>' +
              '<div style="margin-top: 10px; font-size: 10px;">–°–ø—Ä–æ–±—É–π—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ Chrome –Ω–∞ Android</div>';
          }
        }).catch(() => {
          statusElement.innerHTML = 'WebXR: <span class="status-error">–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ</span>';
        });
      } else {
        statusElement.innerHTML = 'WebXR: <span class="status-error">–ù–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è</span>';
      }
    }

    async function createSaturn() {
      // –ì—Ä—É–ø–∞ –¥–ª—è –°–∞—Ç—É—Ä–Ω–∞
      saturnGroup = new THREE.Group();
      saturnGroup.visible = true;

      // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–µ–∫—Å—Ç—É—Ä–∏ –°–∞—Ç—É—Ä–Ω–∞
      const saturnTexture = await loadSaturnTexture();

      // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –°–∞—Ç—É—Ä–Ω–∞
      const saturnGeometry = new THREE.SphereGeometry(0.2, 32, 32);
      const saturnMaterial = new THREE.MeshStandardMaterial({ 
        map: saturnTexture,
        roughness: 0.8,
        metalness: 0.1
      });
      
      saturn = new THREE.Mesh(saturnGeometry, saturnMaterial);
      saturn.castShadow = true;
      saturn.receiveShadow = true;
      saturnGroup.add(saturn);

      // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫—ñ–ª–µ—Ü—å
      const ringGeometry = new THREE.RingGeometry(0.25, 0.45, 64);
      const ringMaterial = new THREE.MeshBasicMaterial({ 
        color: 0xd4b494, 
        side: THREE.DoubleSide, 
        transparent: true, 
        opacity: 0.6 
      });
      
      ring = new THREE.Mesh(ringGeometry, ringMaterial);
      ring.rotation.x = -Math.PI / 2;
      saturnGroup.add(ring);

      scene.add(saturnGroup);
    }

    function loadSaturnTexture() {
      const textureLoader = new THREE.TextureLoader();
      textureLoader.setCrossOrigin('anonymous');
      
      return new Promise((resolve) => {
        textureLoader.load(
          'https://upload.wikimedia.org/wikipedia/commons/thumb/c/c1/Saturn_from_Cassini_Orbiter_%282004-10-06%29.jpg/1024px-Saturn_from_Cassini_Orbiter_%282004-10-06%29.jpg',
          (texture) => {
            texture.colorSpace = THREE.SRGBColorSpace;
            console.log('Saturn texture loaded successfully');
            resolve(texture);
          },
          undefined,
          (error) => {
            console.warn('Error loading Saturn texture, using fallback:', error);
            const fallbackTexture = createFallbackSaturnTexture();
            resolve(fallbackTexture);
          }
        );
      });
    }

    function createFallbackSaturnTexture() {
      const canvas = document.createElement('canvas');
      canvas.width = 512;
      canvas.height = 256;
      const ctx = canvas.getContext('2d');
      
      // –ë–∞–∑–æ–≤–∏–π –∫–æ–ª—ñ—Ä –°–∞—Ç—É—Ä–Ω–∞
      const gradient = ctx.createLinearGradient(0, 0, 512, 256);
      gradient.addColorStop(0, '#fad5a5');
      gradient.addColorStop(0.3, '#f0c674');
      gradient.addColorStop(0.7, '#e6b45c');
      gradient.addColorStop(1, '#d4a244');
      
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, 512, 256);
      
      // –î–æ–¥–∞—î–º–æ —Å–º—É–≥–∏
      ctx.fillStyle = 'rgba(210, 180, 140, 0.3)';
      for (let i = 0; i < 8; i++) {
        const y = (i * 32) + 16;
        ctx.fillRect(0, y, 512, 16);
      }
      
      const texture = new THREE.CanvasTexture(canvas);
      return texture;
    }

    function createReticle() {
      const geometry = new THREE.RingGeometry(0.1, 0.11, 32).rotateX(-Math.PI / 2);
      const material = new THREE.MeshBasicMaterial({ 
        color: 0x00ff00,
        transparent: true,
        opacity: 0.8
      });
      reticle = new THREE.Mesh(geometry, material);
      reticle.matrixAutoUpdate = false;
      reticle.visible = false;
      scene.add(reticle);
    }

    function setupLighting() {
      // –û—Å–Ω–æ–≤–Ω–µ —Å–≤—ñ—Ç–ª–æ
      const light = new THREE.HemisphereLight(0xffffff, 0xbbbbff, 1);
      scene.add(light);

      // –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–µ —Å–≤—ñ—Ç–ª–æ –¥–ª—è —Ç—ñ–Ω–µ–π
      const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
      directionalLight.position.set(5, 5, 5);
      directionalLight.castShadow = true;
      directionalLight.shadow.mapSize.width = 1024;
      directionalLight.shadow.mapSize.height = 1024;
      scene.add(directionalLight);
    }

    function onSessionStart() {
      document.getElementById('session-status').innerHTML = '–°–µ—Å—ñ—è: <span class="status-active">–ê–∫—Ç–∏–≤–Ω–∞</span>';
      document.getElementById('instructions').innerHTML = 
        '<div>üéØ –ù–∞–ø—Ä–∞–≤—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ –ø–æ–≤–µ—Ä—Ö–Ω—é —Ç–∞ —Ç–æ—Ä–∫–Ω—ñ—Ç—å—Å—è –¥–ª—è —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è –°–∞—Ç—É—Ä–Ω–∞</div>';
      
      const session = renderer.xr.getSession();
      
      // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è hit test
      session.requestReferenceSpace('viewer').then((referenceSpace) => {
        session.requestHitTestSource({ space: referenceSpace }).then((source) => {
          hitTestSource = source;
        });
      });
      
      // –û–±—Ä–æ–±–Ω–∏–∫ –≤–∏–±–æ—Ä—É
      const controller = renderer.xr.getController(0);
      controller.addEventListener('select', onSelect);
      scene.add(controller);
      
      session.addEventListener('end', onSessionEnd);
      hitTestSourceRequested = true;
      
      // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ –°–∞—Ç—É—Ä–Ω–∞ –¥–æ —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è
      saturnGroup.visible = false;
    }

    function onSessionEnd() {
      document.getElementById('session-status').innerHTML = '–°–µ—Å—ñ—è: <span>–ù–µ–∞–∫—Ç–∏–≤–Ω–∞</span>';
      document.getElementById('instructions').innerHTML = 
        '<div>üì± –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É AR –¥–ª—è –∑–∞–ø—É—Å–∫—É –¥–æ–ø–æ–≤–Ω–µ–Ω–æ—ó —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—ñ</div>';
      
      hitTestSourceRequested = false;
      hitTestSource = null;
      reticle.visible = false;
      
      // –ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –¥–æ –∑–≤–∏—á–∞–π–Ω–æ–≥–æ —Ä–µ–∂–∏–º—É
      saturnGroup.position.copy(originalPosition);
      saturnGroup.scale.setScalar(0.5);
      saturnGroup.visible = true;
    }

    function onSelect() {
      if (reticle.visible) {
        // –†–æ–∑–º—ñ—â–µ–Ω–Ω—è –°–∞—Ç—É—Ä–Ω–∞ –Ω–∞ –≤–∏–±—Ä–∞–Ω—ñ–π –ø–æ–≤–µ—Ä—Ö–Ω—ñ
        saturnGroup.position.setFromMatrixPosition(reticle.matrix);
        saturnGroup.scale.setScalar(0.1); // –ó–º–µ–Ω—à–µ–Ω–Ω—è –¥–ª—è AR
        saturnGroup.visible = true;
        reticle.visible = false;
      }
    }

    function animate() {
      if (isAnimating && saturn) {
        saturn.rotation.y += rotationSpeed * animationSpeed;
      }

      // Hit testing –¥–ª—è AR
      if (renderer.xr.isPresenting && hitTestSource) {
        const session = renderer.xr.getSession();
        const frame = renderer.xr.getFrame();
        
        if (frame) {
          const referenceSpace = renderer.xr.getReferenceSpace();
          const hitTestResults = frame.getHitTestResults(hitTestSource);
          
          if (hitTestResults.length > 0 && !saturnGroup.visible) {
            const hit = hitTestResults[0];
            reticle.visible = true;
            reticle.matrix.fromArray(hit.getPose(referenceSpace).transform.matrix);
          } else if (saturnGroup.visible) {
            reticle.visible = false;
          }
        }
      }

      renderer.render(scene, camera);
    }

    function onWindowResize() {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    }

    // –ì–ª–æ–±–∞–ª—å–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è
    window.toggleAnimation = () => {
      isAnimating = !isAnimating;
      const button = event.target;
      button.innerHTML = isAnimating ? '‚è∏Ô∏è –ü–∞—É–∑–∞' : '‚ñ∂Ô∏è –°—Ç–∞—Ä—Ç';
      document.getElementById('rotation-speed').textContent = isAnimating ? `${animationSpeed}x` : '0x';
    };

    window.changeSpeed = () => {
      animationSpeed = animationSpeed === 1 ? 2 : animationSpeed === 2 ? 5 : 1;
      event.target.innerHTML = `‚ö° x${animationSpeed}`;
      document.getElementById('rotation-speed').textContent = `${animationSpeed}x`;
    };

    window.toggleRings = () => {
      ringsVisible = !ringsVisible;
      if (ring) {
        ring.visible = ringsVisible;
      }
      event.target.innerHTML = ringsVisible ? 'üíç –ö—ñ–ª—å—Ü—è' : 'üíç –ë–µ–∑ –∫—ñ–ª–µ—Ü—å';
      document.getElementById('rings-opacity').textContent = ringsVisible ? '60%' : '0%';
    };

    window.resetPosition = () => {
      if (renderer.xr.isPresenting) {
        saturnGroup.visible = false;
        reticle.visible = true;
      } else {
        saturnGroup.position.copy(originalPosition);
        saturnGroup.scale.setScalar(0.5);
      }
      
      // –°–∫–∏–¥–∞–Ω–Ω—è –∞–Ω—ñ–º–∞—Ü—ñ—ó
      if (saturn) {
        saturn.rotation.y = 0;
      }
    };

    // –ó–∞–ø—É—Å–∫ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó
    init().catch(error => {
      console.error('Error during initialization:', error);
      document.getElementById('status').innerHTML = 
        '<div style="color: #f44336;">‚ùå –ü–æ–º–∏–ª–∫–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó</div><div>–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –¥–µ—Ç–∞–ª–µ–π</div>';
    });
  </script>
</body>
</html>






